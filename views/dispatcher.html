<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TAXI DISPATCHER</title>
    <link rel="stylesheet" href="leaflet/leaflet.css">
    <link rel="stylesheet" href="css/dispatcher.css">
    <script src="/vue/vue.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/leaflet/leaflet.js"></script>
    <script src="js/dispatcher.js" defer></script>
  </head>
  <body>
    <header>
      <h1><span class="bnt">bnt\</span><span class="header-taxi">taxi</span></h1>
      <h2>Dispatch</h2>
    </header>
    
    <main id="page">
      
      <!-- Section for the assignment of customers to cars -->
      <section id="assignment" class="left">

	<!-- Navigation bar for assignment menu -->
	<nav>
	  <ul>
	    <li
	      v-bind:class="{selected: currentAssignmentMenu == 'orders'}"
	      v-on:click="currentAssignmentMenu = 'orders'">
	      Orders
	    </li>
	    
	    <li v-bind:class="{selected: currentAssignmentMenu == 'taxis'}"
		v-on:click="currentAssignmentMenu = 'taxis'">
	      Taxis
	    </li>
	    
	    <li v-bind:class="{selected: currentAssignmentMenu == 'ongoing'}"
		v-on:click="currentAssignmentMenu = 'ongoing'">
	      Ongoing
	    </li>
	  </ul>
	</nav>
	

	<!-- List of pending orders -->
	
	<ul class="assignment-list" v-if="currentAssignmentMenu == 'orders'">
	  <div v-for="order in orders" v-if="!orderIsAssigned(order)">
	    <li class="assignment-list-item"
		v-on:click="selectedOrder = (selectedOrder != order) ? order : null"
		v-bind:class="{selected: selectedOrder == order}">
	      <div class="timer">
		<h2>{{Math.round((((new Date() - order.timeJoined) % 86400000) % 3600000) / 60000)}} min</h2>
	      </div>

	      <div class="description">
		<h2><span class="from">{{order.name}}</span>&nbsp;
		  <span class="to">{{order.rating}} stars</span></h2>
		<h3>
		  <span class="from">
		    Going from
		    {{order.fromLatLong[0].toFixed(3)}},
		    {{order.fromLatLong[1].toFixed(3)}}
		  </span>
		  <span class="to">
		    Going to
		    {{order.destLatLong[0].toFixed(3)}},
		    {{order.destLatLong[1].toFixed(3)}}
		  </span>
		</h3>
		<p v-show="orderIsPending(order)">Waiting for both parties to accept</p>

		<ul>
		  <li v-for="(item, key) in order.orderItems">
		    {{ key + ": " + item }}
		  </li>
		</ul>
	      </div>
	    </li>
	    <ul v-if="order == selectedOrder" class="assignment-selection">
	      <li v-for="taxi in taxis" v-on:click="assignTaxi(order, taxi)">
		<h3>{{taxi.name}}&nbsp;{{taxi.rating}} stars</h3>
		<p>Current distance: {{ taxi.latLong[0].toFixed(3) }}, {{ taxi.latLong[1].toFixed(3) }}</p>
	      </li>
	    </ul>
	  </div>

	  
	  <li class="assignment-list-item" v-if="ordersLength() == 0">
	    <h2>There are no customers waiting</h2>
	  </li>
	</ul>


	<!-- List of available taxis -->
	
	<ul class="assignment-list" v-if="currentAssignmentMenu == 'taxis'">
	  <div v-for="taxi in taxis" v-if="!taxiIsAssigned(taxi)">
	    <li class="assignment-list-item"
		v-on:click="selectedTaxi = (selectedTaxi != taxi) ? taxi : null"
		v-bind:class="{selected: selectedTaxi == taxi}">
	      <p>Driver: {{taxi.name}}</p>
	      <p>Rating: {{taxi.rating}}</p>
	      <p>Taxi ID: #{{taxi.taxiId}}</p>
	      <p>Current position: {{ taxi.latLong[0].toFixed(3) }}, {{ taxi.latLong[1].toFixed(3) }}</p>
	      <p v-show="taxiIsPending(taxi)">Waiting for both parties to accept</p>
	    </li>
	    
	    <ul v-if="taxi == selectedTaxi" class="assignment-selection">
	      <li v-for="order in orders" v-on:click="assignTaxi(order, taxi)">
		Order ID: #{{order.orderId}}
		Current position: {{ order.fromLatLong[0].toFixed(3) }}, {{ order.fromLatLong[1].toFixed(3) }}
	      </li>
	    </ul>
	  </div>

	  
	  <li class="assignment-list-item" v-if="taxisLength() == 0">
	    <h2>There are no taxis currently available</h2>
	  </li>
	</ul>


	<!-- List of ongoing trips -->
	
	<ul class="assignment-list" v-if="currentAssignmentMenu == 'ongoing'">
	  <div v-for="trip in trips">
	    <li class="assignment-list-item"
		v-on:click="selectedTrip = (selectedTrip != trip) ? trip : null"
		v-bind:class="{selected: selectedTrip == trip}">
	      <p>Trip ID: #{{trip.tripId}}</p>
	    </li>
	    
	    <ul v-if="trip == selectedTrip" class="assignment-selection">
	      <li>
		<p>Order ID: {{trip.order.orderId}} </p>
		<p>Taxi ID: {{trip.taxi.taxiId}} </p>
		<p>The driver has {{trip.driverAccept ? "accepted" : "not accepted"}} the assignment</p>
		<p>The customer has {{trip.customerAccept ? "accepted" : "not accepted"}} the assignment </p>
	      </li>
	    </ul>
	  </div>
	  
	  <li class="assignment-list-item" v-if="Object.keys(trips).length == 0">
	    <h2>There are no currently ongoing trips</h2>
	  </li>
	</ul>
      </section>


      <!-- Section for map with information -->
      <section id="maps">
	<div id="my-map"></div>
      </section>
    </main>
  </body>
</html>
